name: Build inmoose wheel (cp311)

on:
  workflow_dispatch: {}

jobs:
  wheel:
    runs-on: windows-latest
    steps:
      - name: Set up Python 3.11 x64
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          architecture: 'x64'

      - name: Upgrade build deps
        shell: pwsh
        run: |
          python -m pip install --upgrade pip setuptools wheel cython

      - name: Build wheel from PyPI sdist
        shell: pwsh
        run: |
          pip download inmoose==0.8.1 --no-binary=:all: -d dist
          $sdist = Get-ChildItem dist\inmoose-*.tar.gz | Select-Object -First 1
          python -m pip wheel $sdist.FullName -w wheelhouse

      - name: List wheels
        shell: pwsh
        run: Get-ChildItem wheelhouse

      - name: Upload wheel artifact
        uses: actions/upload-artifact@v4
        with:
          name: inmoose-wheels
          path: wheelhouse/*.whl
